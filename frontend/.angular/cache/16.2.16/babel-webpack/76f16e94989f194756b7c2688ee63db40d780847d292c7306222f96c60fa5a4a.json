{"ast":null,"code":"import { Observable } from 'rxjs';\nimport { environment } from '../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport let ChatService = /*#__PURE__*/(() => {\n  class ChatService {\n    constructor(http, zone) {\n      this.http = http;\n      this.zone = zone;\n      this.apiUrl = environment.apiUrl;\n    }\n    sendMessageStream(query, sessionId) {\n      return new Observable(observer => {\n        const url = `${this.apiUrl}/chat/stream?q=${encodeURIComponent(query)}&sessionId=${sessionId}`;\n        const eventSource = new EventSource(url);\n        eventSource.onmessage = event => {\n          // This usually catches messages without event type, but we use named events\n        };\n        eventSource.addEventListener('meta', event => {\n          this.zone.run(() => observer.next({\n            type: 'meta',\n            data: JSON.parse(event.data)\n          }));\n        });\n        eventSource.addEventListener('token', event => {\n          this.zone.run(() => observer.next({\n            type: 'token',\n            data: JSON.parse(event.data)\n          }));\n        });\n        eventSource.addEventListener('done', event => {\n          this.zone.run(() => {\n            observer.next({\n              type: 'done',\n              data: JSON.parse(event.data)\n            });\n            observer.complete();\n            eventSource.close();\n          });\n        });\n        eventSource.onerror = error => {\n          this.zone.run(() => {\n            observer.error(error);\n            eventSource.close();\n          });\n        };\n        return () => eventSource.close();\n      });\n    }\n    static {\n      this.ɵfac = function ChatService_Factory(t) {\n        return new (t || ChatService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i0.NgZone));\n      };\n    }\n    static {\n      this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n        token: ChatService,\n        factory: ChatService.ɵfac,\n        providedIn: 'root'\n      });\n    }\n  }\n  return ChatService;\n})();","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}