{"ast":null,"code":"import { Observable } from 'rxjs';\nimport { environment } from '../environments/environment';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nexport class ChatService {\n  constructor(http, zone) {\n    this.http = http;\n    this.zone = zone;\n    this.apiUrl = environment.apiUrl;\n  }\n  sendMessageStream(query, sessionId) {\n    return new Observable(observer => {\n      const url = `${this.apiUrl}/chat/stream?q=${encodeURIComponent(query)}&sessionId=${sessionId}`;\n      const eventSource = new EventSource(url);\n      eventSource.onmessage = event => {\n        // This usually catches messages without event type, but we use named events\n      };\n      eventSource.addEventListener('meta', event => {\n        this.zone.run(() => observer.next({\n          type: 'meta',\n          data: JSON.parse(event.data)\n        }));\n      });\n      eventSource.addEventListener('token', event => {\n        this.zone.run(() => observer.next({\n          type: 'token',\n          data: JSON.parse(event.data)\n        }));\n      });\n      eventSource.addEventListener('done', event => {\n        this.zone.run(() => {\n          observer.next({\n            type: 'done',\n            data: JSON.parse(event.data)\n          });\n          observer.complete();\n          eventSource.close();\n        });\n      });\n      eventSource.onerror = error => {\n        this.zone.run(() => {\n          observer.error(error);\n          eventSource.close();\n        });\n      };\n      return () => eventSource.close();\n    });\n  }\n  static {\n    this.ɵfac = function ChatService_Factory(t) {\n      return new (t || ChatService)(i0.ɵɵinject(i1.HttpClient), i0.ɵɵinject(i0.NgZone));\n    };\n  }\n  static {\n    this.ɵprov = /*@__PURE__*/i0.ɵɵdefineInjectable({\n      token: ChatService,\n      factory: ChatService.ɵfac,\n      providedIn: 'root'\n    });\n  }\n}","map":{"version":3,"names":["Observable","environment","ChatService","constructor","http","zone","apiUrl","sendMessageStream","query","sessionId","observer","url","encodeURIComponent","eventSource","EventSource","onmessage","event","addEventListener","run","next","type","data","JSON","parse","complete","close","onerror","error","i0","ɵɵinject","i1","HttpClient","NgZone","factory","ɵfac","providedIn"],"sources":["/Users/sanaiqbal/Codes/rag-poc/frontend/src/app/chat.service.ts"],"sourcesContent":["import { Injectable, NgZone } from '@angular/core';\nimport { HttpClient } from '@angular/common/http';\nimport { Observable, Subject } from 'rxjs';\nimport { environment } from '../environments/environment';\n\nexport interface ChatMessage {\n    id: string;\n    role: 'user' | 'assistant';\n    content: string;\n    citations?: Citation[];\n    isStreaming?: boolean;\n}\n\nexport interface Citation {\n    id: string;\n    title: string;\n    score: number;\n}\n\n@Injectable({\n    providedIn: 'root'\n})\nexport class ChatService {\n    private apiUrl = environment.apiUrl;\n\n    constructor(private http: HttpClient, private zone: NgZone) { }\n\n    sendMessageStream(query: string, sessionId: string): Observable<any> {\n        return new Observable(observer => {\n            const url = `${this.apiUrl}/chat/stream?q=${encodeURIComponent(query)}&sessionId=${sessionId}`;\n            const eventSource = new EventSource(url);\n\n            eventSource.onmessage = (event) => {\n                // This usually catches messages without event type, but we use named events\n            };\n\n            eventSource.addEventListener('meta', (event: any) => {\n                this.zone.run(() => observer.next({ type: 'meta', data: JSON.parse(event.data) }));\n            });\n\n            eventSource.addEventListener('token', (event: any) => {\n                this.zone.run(() => observer.next({ type: 'token', data: JSON.parse(event.data) }));\n            });\n\n            eventSource.addEventListener('done', (event: any) => {\n                this.zone.run(() => {\n                    observer.next({ type: 'done', data: JSON.parse(event.data) });\n                    observer.complete();\n                    eventSource.close();\n                });\n            });\n\n            eventSource.onerror = (error) => {\n                this.zone.run(() => {\n                    observer.error(error);\n                    eventSource.close();\n                });\n            };\n\n            return () => eventSource.close();\n        });\n    }\n}\n"],"mappings":"AAEA,SAASA,UAAU,QAAiB,MAAM;AAC1C,SAASC,WAAW,QAAQ,6BAA6B;;;AAmBzD,OAAM,MAAOC,WAAW;EAGpBC,YAAoBC,IAAgB,EAAUC,IAAY;IAAtC,KAAAD,IAAI,GAAJA,IAAI;IAAsB,KAAAC,IAAI,GAAJA,IAAI;IAF1C,KAAAC,MAAM,GAAGL,WAAW,CAACK,MAAM;EAE2B;EAE9DC,iBAAiBA,CAACC,KAAa,EAAEC,SAAiB;IAC9C,OAAO,IAAIT,UAAU,CAACU,QAAQ,IAAG;MAC7B,MAAMC,GAAG,GAAG,GAAG,IAAI,CAACL,MAAM,kBAAkBM,kBAAkB,CAACJ,KAAK,CAAC,cAAcC,SAAS,EAAE;MAC9F,MAAMI,WAAW,GAAG,IAAIC,WAAW,CAACH,GAAG,CAAC;MAExCE,WAAW,CAACE,SAAS,GAAIC,KAAK,IAAI;QAC9B;MAAA,CACH;MAEDH,WAAW,CAACI,gBAAgB,CAAC,MAAM,EAAGD,KAAU,IAAI;QAChD,IAAI,CAACX,IAAI,CAACa,GAAG,CAAC,MAAMR,QAAQ,CAACS,IAAI,CAAC;UAAEC,IAAI,EAAE,MAAM;UAAEC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACP,KAAK,CAACK,IAAI;QAAC,CAAE,CAAC,CAAC;MACtF,CAAC,CAAC;MAEFR,WAAW,CAACI,gBAAgB,CAAC,OAAO,EAAGD,KAAU,IAAI;QACjD,IAAI,CAACX,IAAI,CAACa,GAAG,CAAC,MAAMR,QAAQ,CAACS,IAAI,CAAC;UAAEC,IAAI,EAAE,OAAO;UAAEC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACP,KAAK,CAACK,IAAI;QAAC,CAAE,CAAC,CAAC;MACvF,CAAC,CAAC;MAEFR,WAAW,CAACI,gBAAgB,CAAC,MAAM,EAAGD,KAAU,IAAI;QAChD,IAAI,CAACX,IAAI,CAACa,GAAG,CAAC,MAAK;UACfR,QAAQ,CAACS,IAAI,CAAC;YAAEC,IAAI,EAAE,MAAM;YAAEC,IAAI,EAAEC,IAAI,CAACC,KAAK,CAACP,KAAK,CAACK,IAAI;UAAC,CAAE,CAAC;UAC7DX,QAAQ,CAACc,QAAQ,EAAE;UACnBX,WAAW,CAACY,KAAK,EAAE;QACvB,CAAC,CAAC;MACN,CAAC,CAAC;MAEFZ,WAAW,CAACa,OAAO,GAAIC,KAAK,IAAI;QAC5B,IAAI,CAACtB,IAAI,CAACa,GAAG,CAAC,MAAK;UACfR,QAAQ,CAACiB,KAAK,CAACA,KAAK,CAAC;UACrBd,WAAW,CAACY,KAAK,EAAE;QACvB,CAAC,CAAC;MACN,CAAC;MAED,OAAO,MAAMZ,WAAW,CAACY,KAAK,EAAE;IACpC,CAAC,CAAC;EACN;;;uBAvCSvB,WAAW,EAAA0B,EAAA,CAAAC,QAAA,CAAAC,EAAA,CAAAC,UAAA,GAAAH,EAAA,CAAAC,QAAA,CAAAD,EAAA,CAAAI,MAAA;IAAA;EAAA;;;aAAX9B,WAAW;MAAA+B,OAAA,EAAX/B,WAAW,CAAAgC,IAAA;MAAAC,UAAA,EAFR;IAAM;EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}